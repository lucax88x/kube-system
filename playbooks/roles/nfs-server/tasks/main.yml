---
- name: Add nfs server packages
  ansible.builtin.dnf:
    name:
      - nfs-utils
    state: present

- name: Enable nfs-server service
  ansible.builtin.systemd:
    name: nfs-server
    enabled: true

- name: Creates store directory
  ansible.builtin.file:
    path: "{{ nfs_folder }}"
    state: directory
    recurse: true
    owner: nobody
    group: nobody
    mode: 0775

- name: Create exports settings
  ansible.builtin.template:
    src: templates/exports.j2
    dest: /etc/exports
    owner: root
    group: root
    mode: 0644

- name: Re-export the share
  ansible.builtin.command: exportfs -rav
  changed_when: true

- name: Enable nfs-server service
  ansible.builtin.systemd:
    name: nfs-server
    state: restarted
